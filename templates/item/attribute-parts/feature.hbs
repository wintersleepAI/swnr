{{! Attributes Tab }}
<section class='tab attributes {{tab.cssClass}}' data-group='primary' data-tab='attributes'>
  
  {{! Pool Configuration }}
  <fieldset>
    <legend>Resource Pool Grants</legend>
    <p class="help-text">Configure what resource pools this Feature/Focus/Edge grants to the character.</p>
    
    <div class="pools-granted-container">
      {{#each system.poolsGranted as |pool index|}}
        <div class="pool-config" data-pool-index="{{index}}">
          <div class="pool-config-header">
            <h4>Pool Grant {{@index}}</h4>
            <button type="button" class="pool-remove-btn" data-action="removePool" data-pool-index="{{index}}" title="Remove Pool">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          
          <div class='grid grid-3col'>
            <div class="resource">
              <label class="resource-label">Resource Type</label>
              <select name="system.poolsGranted.{{index}}.resourceName" data-dtype="String">
                <option value="Effort" {{#if (eq pool.resourceName "Effort")}}selected{{/if}}>Effort</option>
                <option value="Slots" {{#if (eq pool.resourceName "Slots")}}selected{{/if}}>Spell Slots</option>
                <option value="Points" {{#if (eq pool.resourceName "Points")}}selected{{/if}}>Power Points</option>
                <option value="Strain" {{#if (eq pool.resourceName "Strain")}}selected{{/if}}>System Strain</option>
                <option value="Uses" {{#if (eq pool.resourceName "Uses")}}selected{{/if}}>Daily Uses</option>
              </select>
            </div>
            
            <div class="resource">
              <label class="resource-label">Sub-Resource</label>
              <input type="text" name="system.poolsGranted.{{index}}.subResource" value="{{pool.subResource}}" 
                     data-dtype="String" placeholder="e.g. Psychic, Elementalist, Lv1" />
            </div>
            
            <div class="resource">
              <label class="resource-label">Refresh Cadence</label>
              <select name="system.poolsGranted.{{index}}.cadence" data-dtype="String">
                <option value="scene" {{#if (eq pool.cadence "scene")}}selected{{/if}}>Scene</option>
                <option value="rest" {{#if (eq pool.cadence "rest")}}selected{{/if}}>Rest</option>
                <option value="day" {{#if (eq pool.cadence "day")}}selected{{/if}}>Day</option>
                <option value="commit" {{#if (eq pool.cadence "commit")}}selected{{/if}}>Commit (Long-term)</option>
                <option value="user" {{#if (eq pool.cadence "user")}}selected{{/if}}>Custom</option>
              </select>
            </div>
          </div>
          
          <div class='grid grid-3col'>
            <div class="resource">
              <label class="resource-label">Base Amount</label>
              <input type="number" name="system.poolsGranted.{{index}}.baseAmount" value="{{pool.baseAmount}}" 
                     data-dtype="Number" min="0" />
            </div>
            
            <div class="resource">
              <label class="resource-label">Per Level</label>
              <input type="number" name="system.poolsGranted.{{index}}.perLevel" value="{{pool.perLevel}}" 
                     data-dtype="Number" min="0" step="0.5" />
            </div>
            
            <div class="resource">
              <label class="resource-label">Formula (Optional)</label>
              <input type="text" name="system.poolsGranted.{{index}}.formula" value="{{pool.formula}}" 
                     data-dtype="String" placeholder="@level + @stats.cha.mod" />
            </div>
          </div>
          
          <div class='grid grid-1col'>
            <div class="resource">
              <label class="resource-label">Condition (Optional)</label>
              <input type="text" name="system.poolsGranted.{{index}}.condition" value="{{pool.condition}}" 
                     data-dtype="String" placeholder="@level >= 3" />
            </div>
          </div>
          
          <div class="pool-help">
            <details>
              <summary><i class="fas fa-question-circle"></i> Pool Configuration Help</summary>
              <div class="help-content">
                <p><strong>Formula:</strong> Use @level for character level, @stats.str.mod for stat modifiers. If specified, overrides Base + Per Level calculation.</p>
                <p><strong>Condition:</strong> Pool only granted if condition is true (e.g., "@level >= 3" for level 3+).</p>
                <p><strong>Examples:</strong></p>
                <ul>
                  <li><strong>Psychic Training:</strong> Effort:Psychic, Base: 1, Per Level: 1</li>
                  <li><strong>Elementalist:</strong> Effort:Elementalist, Formula: "@level + @stats.cha.mod"</li>
                  <li><strong>High Mage:</strong> Slots:Unleveled, Base: 2, Per Level: 1</li>
                </ul>
              </div>
            </details>
          </div>
        </div>
      {{/each}}
      
      {{#unless system.poolsGranted.length}}
        <div class="no-pools-message">
          <p><i class="fas fa-info-circle"></i> This feature does not grant any resource pools. Click "Add Pool Grant" to configure pools.</p>
        </div>
      {{/unless}}
    </div>
    
    <div class="pool-controls">
      <button type="button" class="add-pool-btn" data-action="addPool">
        <i class="fas fa-plus"></i> Add Pool Grant
      </button>
    </div>
  </fieldset>
</section>