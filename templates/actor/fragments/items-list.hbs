    <ol class="items-list">
      {{!-- CONTAINERS SECTION (show for all types but only populate from gear/item containers) --}}
      {{#if true}}
        {{!-- Two-pass approach: first check if any containers exist --}}
        {{#each itemList as |item id|}}
          {{#if item.system.container.isContainer}}
            {{#if @first}}
              {{!-- CONTAINERS HEADER ROW (shown only once) --}}
              <li class="flex flexrow items-header" style="background-color: var(--accent-color); color: var(--text-light);">
                <div class="item-name-long">{{ localize 'swnr.item.containers' }}</div>
                <div class="item-enc item-prop">{{ localize 'swnr.item.enc' }}</div>
                <div class="item-qty item-prop">{{ localize 'swnr.item.capacity' }}</div>
                <div class="item-loc item-prop" style="flex: 0 0 130px;">{{ localize 'swnr.item.location' }}</div>
                <div class="item-formula item-prop">{{ localize 'SWN.Item.Gear.FIELDS.rollFormula.label' }}</div>
                <div class="item-controls item-prop">
                  {{#if @root.editable}}
                    <a class="item-control item-search" title="{{ localize 'swnr.sheet.search-item'}}" data-item-type="{{ ../type }}" data-item-name="{{ ../name }}">
                      <i class="fas fa-search"></i>
                    </a>
                    <a class="item-control item-create" title="{{ localize "DOCUMENT.Create" type='Item'}}" data-action="createDoc" data-document-class="Item" data-type="{{../type}}">
                      <i class="fas fa-plus"></i> {{ localize 'DOCUMENT.New' type=../type}}
                    </a>
                  {{/if}}
                </div>
              </li>
              {{!-- Break out of first container check --}}
            {{/if}}
          {{/if}}
        {{/each}}
        
        {{!-- Second pass: render all containers and their contents --}}
        {{#each itemList as |item id|}}
          {{#if item.system.container.isContainer}}
            <li class="item flex flexrow" data-item-id="{{item._id}}" data-drag="true" data-document-class="Item" style="background-color: var(--light-background);">
              <div class="item-name-long" style="display: flex; align-items: center;">
                <div class="item-image" style="margin-right: 0.5em;">
                  <a class="rollable" data-roll-type="item" data-action="roll">
                    <img src="{{item.img}}" title="{{item.name}}" width="24" height="24" />
                  </a>
                </div>
                <div>
                  {{#if item.system.container.isOpen}}
                    <i class="fas fa-box-open container-toggle" 
                       title="{{ localize 'swnr.item.container.close' }}" 
                       data-action="toggleContainer" 
                       data-item-id="{{item.id}}" 
                       style="margin-right: 0.5em; cursor: pointer; opacity: 0.8;"></i>
                  {{else}}
                    <i class="fas fa-box container-toggle" 
                       title="{{ localize 'swnr.item.container.open' }}" 
                       data-action="toggleContainer" 
                       data-item-id="{{item.id}}" 
                       style="margin-right: 0.5em; cursor: pointer; opacity: 0.6;"></i>
                  {{/if}}
                  <span data-action="toggleItemDescription" data-item-id="{{item.id}}" style="cursor: pointer;">
                    {{item.name}}
                  </span>
                  <i class="fas fa-box" title="{{ localize 'swnr.item.container.tooltip' }}" style="margin-left: 0.5em; opacity: 0.4; font-size: 0.8em;"></i>
                </div>
              </div>
              <div class="item-enc item-prop">{{ item.system.encumbrance }}</div>
              <div class="item-qty item-prop">{{ item.system.container.capacity.value }}/{{ item.system.container.capacity.max }}</div>
              <div class="item-loc item-prop" style="flex: 0 0 130px;">
                <select data-item-id="{{item.id}}" class="location-selector">
                  {{selectOptions ../config/itemLocations selected=system.location localize=true}}
                </select>
              </div>
              <div class="item-formula item-prop">{{item.system.rollFormula}}</div>
              <div class="item-controls item-prop">
                <a class="item-control item-edit" title="{{ localize "DOCUMENT.Update" type='Item'}}" data-action="viewDoc">
                  <i class="fas fa-edit"></i>
                </a>
                {{#if @root.editable}}
                  <a class="item-control item-delete" title="{{ localize "DOCUMENT.Delete" type='Item'}}" data-action="deleteDoc">
                    <i class="fas fa-trash"></i>
                  </a>
                {{/if}}
              </div>
            </li>
            <!-- Container Description Row -->
            <li class="item-description" style="display: {{#if (lookup @root.expandedDescriptions item.id)}}block{{else}}none{{/if}}; background-color: var(--color-bg-option); border-left: 3px solid var(--accent-color); margin-left: 1em; padding: 0.5em;">
              <div class="item-description-content">
                <strong>{{localize "SWN.Actor.Tabs.Description"}}:</strong>
                <div style="margin-top: 0.25em; white-space: pre-wrap;">{{{item.system.description}}}</div>
              </div>
            </li>
            
            {{!-- Show contained items when container is open --}}
            {{#if item.system.container.isOpen}}
              {{#each @root.actor.items as |containedItem containedId|}}
                {{#if (eq containedItem.system.containerId item.id)}}
                  <li class="item flex flexrow contained-item" data-item-id="{{containedItem._id}}" data-drag="true" data-document-class="Item" style="background-color: var(--color-bg-option); margin-left: 2em; border-left: 3px solid var(--accent-color);">
                    <div class="item-name-long" style="display: flex; align-items: center;">
                      <div class="item-image" style="margin-right: 0.5em;">
                        <a class="rollable" data-roll-type="item" data-action="roll">
                          <img src="{{containedItem.img}}" title="{{containedItem.name}}" width="20" height="20" />
                        </a>
                      </div>
                      <div>
                        <i class="fas fa-arrow-right" style="margin-right: 0.5em; opacity: 0.5; font-size: 0.8em;"></i>
                        <span data-action="toggleItemDescription" data-item-id="{{containedItem.id}}" style="cursor: pointer;">
                          {{containedItem.name}}
                        </span>
                        {{#if (eq containedItem.type "weapon")}}
                          <i class="fas fa-sword" style="margin-left: 0.5em; opacity: 0.5; font-size: 0.7em;" title="Weapon"></i>
                        {{else if (eq containedItem.type "armor")}}
                          <i class="fas fa-shield-alt" style="margin-left: 0.5em; opacity: 0.5; font-size: 0.7em;" title="Armor"></i>
                        {{/if}}
                      </div>
                    </div>
                    <div class="item-enc item-prop">{{ containedItem.system.encumbrance }}</div>
                    <div class="item-qty item-prop">
                      {{#if (eq containedItem.type "item")}}
                        {{ containedItem.system.quantity }}
                      {{else if (eq containedItem.type "weapon")}}
                        {{containedItem.system.ammo.value}}/{{containedItem.system.ammo.max}}
                      {{else}}
                        -
                      {{/if}}
                    </div>
                    <div class="item-loc item-prop" style="flex: 0 0 130px;">
                      <span style="opacity: 0.6; font-style: italic;">{{ localize 'swnr.item.container.contained' }}</span>
                    </div>
                    <div class="item-formula item-prop">
                      {{#if (eq containedItem.type "weapon")}}
                        {{containedItem.system.damage}}
                      {{else if (eq containedItem.type "armor")}}
                        {{containedItem.system.ac}}
                      {{else}}
                        {{containedItem.system.rollFormula}}
                      {{/if}}
                    </div>
                    <div class="item-controls item-prop">
                      <a class="item-control item-edit" title="{{ localize "DOCUMENT.Update" type='Item'}}" data-action="viewDoc">
                        <i class="fas fa-edit"></i>
                      </a>
                      {{#if @root.editable}}
                        <a class="item-control item-delete" title="{{ localize "DOCUMENT.Delete" type='Item'}}" data-action="deleteDoc">
                          <i class="fas fa-trash"></i>
                        </a>
                      {{/if}}
                    </div>
                  </li>
                  <!-- Contained Item Description Row -->
                  <li class="item-description" style="display: {{#if (lookup @root.expandedDescriptions containedItem.id)}}block{{else}}none{{/if}}; background-color: var(--color-bg-option); border-left: 3px solid var(--accent-color); margin-left: 3em; padding: 0.5em;">
                    <div class="item-description-content">
                      <strong>{{localize "SWN.Actor.Tabs.Description"}}:</strong>
                      <div style="margin-top: 0.25em; white-space: pre-wrap;">{{{containedItem.system.description}}}</div>
                    </div>
                  </li>
                {{/if}}
              {{/each}}
            {{/if}}
          {{/if}}
        {{/each}}
      {{/if}}

      {{!-- REGULAR ITEMS SECTION --}}
      <!-- HEADER ROW -->
      <li class="flex flexrow items-header">
        <!-- Name (left-aligned, no item-prop so it doesn't get borders) -->
        <div class="item-name-long">{{name}}</div>

        <!-- Enc (centered under Enc label) -->
        <div class="item-enc item-prop">
          {{ localize 'swnr.item.enc' }}
        </div>

        {{!-- Quantity (only for items) --}}
        {{#if (eq type "item")}}
          <div class="item-qty item-prop">
            {{ localize 'swnr.item.qty' }}
          </div>
        {{/if}}

        {{!-- Single "Rounds" column if weapon/item with ammo != none --}}
        {{#if (eq item.type "weapon")}}
          <div class="item-rounds item-prop">
            {{ localize 'swnr.item.ammo.value' }}
          </div>
        {{/if}}

        <!-- Location (wider flex so it doesn't truncate) -->
        <div class="item-loc item-prop" style="flex: 0 0 130px;">
          {{ localize 'swnr.item.location' }}
        </div>

        <!-- Damage/AC/Roll Formula -->
        <div class="item-formula item-prop">
          {{#if (eq type "weapon")}}
            {{ localize 'SWN.Item.Weapon.FIELDS.damage.label' }}
          {{else if (eq type "armor")}}
            {{ localize 'SWN.Item.Armor.FIELDS.ac.label' }}
          {{else}}
            {{ localize 'SWN.Item.Gear.FIELDS.rollFormula.label' }}
          {{/if}}
        </div>

        <!-- Controls (edit/delete/search) -->
        <div class="item-controls item-prop">
          {{#if @root.editable}}
            <a
              class="item-control item-search"
              title="{{ localize 'swnr.sheet.search-item'}}"
              data-item-type="{{ type }}"
              data-item-name="{{ name }}"
            >
              <i class="fas fa-search"></i>
            </a>
            <a
              class="item-control item-create"
              title="{{ localize "DOCUMENT.Create" type='Item'}}"
              data-action="createDoc"
              data-document-class="Item"
              data-type="{{type}}"
            >
              <i class="fas fa-plus"></i>
              {{ localize 'DOCUMENT.New' type=type}}
            </a>
          {{/if}}
        </div>
      </li>

      <!-- REGULAR ITEM ROWS (excluding containers and all contained items) -->
      {{#each itemList as |item id|}}
        {{#unless (or (and (eq item.type "item") item.system.container.isContainer) item.system.containerId)}}
          <li
            class="item flex flexrow"
            data-item-id="{{item._id}}"
            data-drag="true"
            data-document-class="Item"
          >
            <!-- Name/thumbnail (no .item-prop so it's left-aligned) -->
            <div class="item-name-long" style="display: flex; align-items: center;">
              <div class="item-image" style="margin-right: 0.5em;">
                <a class="rollable" data-roll-type="item" data-action="roll">
                  <img
                    src="{{item.img}}"
                    title="{{item.name}}"
                    width="24"
                    height="24"
                  />
                </a>
              </div>
              <div>
                <span data-action="toggleItemDescription" data-item-id="{{item.id}}" style="cursor: pointer;">
                  {{item.name}}
                </span>
                {{#if (eq item.type "armor")}}
                  {{#if (ne item.system.soak.max 0)}}
                    ({{item.system.soak.value}}/{{item.system.soak.max}})
                  {{/if}}
                {{/if}}
              </div>
            </div>

            <!-- Enc (centered under header) -->
            <div class="item-enc item-prop">
              {{ item.system.encumbrance }}
            </div>

            {{!-- Quantity (only if parent is "item") --}}
            {{#if (eq ../type "item")}}
              <div class="item-qty item-prop">
                {{ item.system.quantity }}
              </div>
            {{/if}}
            {{!-- Single Rounds column if ammo != none --}}
            {{#if (eq item.type "weapon")}}
              <div class="item-rounds item-prop">
                {{item.system.ammo.value}} / {{item.system.ammo.max}}
              </div>
            {{/if}}

            <!-- Location (wider so it doesn't truncate) -->
            <div class="item-loc item-prop" style="flex: 0 0 130px;">
              <select data-item-id="{{item.id}}" class="location-selector">
                {{selectOptions ../config/itemLocations selected=system.location localize=true}}
              </select>
            </div>

            <!-- Damage/AC/Roll Formula (centered under header) -->
            <div class="item-formula item-prop">
              {{#if (eq ../type "weapon")}}
                {{item.system.damage}}
              {{else if (eq ../type "armor")}}
                {{item.system.ac}}
              {{else}}
                {{item.system.rollFormula}}
              {{/if}}
            </div>

            <!-- Controls (edit/delete/reload) -->
            <div class="item-controls item-prop">
              {{#if (eq ../type "weapon")}}
                {{#if (ne item.system.ammo.type "none")}}
                  <a
                    class="item-control item-reload"
                    data-action="reload"
                    title="{{ localize "swnr.sheet.reload-item"}}"
                  >
                    <i class="fas fa-retweet"></i>
                  </a>
                {{/if}}
              {{/if}}
              <a
                class="item-control item-edit"
                title="{{ localize "DOCUMENT.Update" type='Item'}}"
                data-action="viewDoc"
              >
                <i class="fas fa-edit"></i>
              </a>
              {{#if @root.editable}}
                <a
                  class="item-control item-delete"
                  title="{{ localize "DOCUMENT.Delete" type='Item'}}"
                  data-action="deleteDoc"
                >
                  <i class="fas fa-trash"></i>
                </a>
              {{/if}}
            </div>
          </li>
          <!-- Item Description Row -->
          <li class="item-description" style="display: {{#if (lookup @root.expandedDescriptions item.id)}}block{{else}}none{{/if}}; background-color: var(--color-bg-option); border-left: 3px solid var(--accent-color); margin-left: 1em; padding: 0.5em;">
            <div class="item-description-content">
              <strong>{{localize "Description"}}:</strong>
              <div style="margin-top: 0.25em; white-space: pre-wrap;">{{{item.system.description}}}</div>
            </div>
          </li>
        {{/unless}}
      {{/each}}
    </ol>
